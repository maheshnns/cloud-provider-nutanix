on:

name: CCM Helm Chart Sync

on:
  release:
    types: [published]

jobs:
  sync-helm-chart:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout CCM repo
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Install GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh

      - name: Run CCM Helm chart sync
        env:
          GITHUB_TOKEN: ${{ secrets.CCM_HELM_SYNC_TOKEN }}
        run: |
          go run ./cmd/ccm-helm-sync/main.go \
            --ccm-repo nutanix-cloud-native/cloud-provider-nutanix \
            --helm-repo nutanix/helm \
            --token "$GITHUB_TOKEN"
